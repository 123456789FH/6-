<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÙƒÙˆÙŠØ² ØªÙØ§Ø¹Ù„ÙŠ â€” Ø§Ø¬ØªØ² 80% Ù„ØªØ­ØµÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</title>
  <meta name="description" content="Ø§Ø®ØªØ¨Ø§Ø± ØªÙØ§Ø¹Ù„ÙŠ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ù…Ø¹ Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø² ØªÙÙØªØ­ Ø¹Ù†Ø¯ ØªØ­Ù‚ÙŠÙ‚ 80% ÙØ£ÙƒØ«Ø± â€” ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª." />
  <style>
    :root{
      --primary:#ff3d71; /* ÙˆØ±Ø¯ÙŠ Ø­Ù…Ø§Ø³ÙŠ */
      --primary-2:#ff6ea2;
      --accent:#ffe55c;  /* Ø£ØµÙØ± Ù„Ù„Ø¬ÙˆØ§Ø¦Ø² */
      --bg:#fff7fb;
      --card:#ffffff;
      --text:#222;
      --muted:#6b7280;
      --success:#22c55e; /* Ø£Ø®Ø¶Ø± Ø§Ù„Ù†Ø¬Ø§Ø­ */
      --danger:#ef4444;  /* Ø£Ø­Ù…Ø± Ø§Ù„ØªØ­Ø°ÙŠØ± */
      --shadow:0 14px 32px rgba(0,0,0,.08);
      --radius:22px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Naskh Arabic", "Noto Sans Arabic", Tahoma, Arial, sans-serif;
      background:
        radial-gradient(1200px 500px at 110% -10%, #ffe3ef 18%, transparent 60%),
        radial-gradient(1100px 500px at -10% 110%, #e0f7fa 14%, transparent 60%),
        var(--bg);
      color:var(--text);
    }
    .wrap{max-width:980px;margin:18px auto;padding:16px}
    header{display:flex;align-items:center;gap:14px;flex-wrap:wrap}
    .logo{
      width:54px;height:54px;border-radius:16px;display:grid;place-items:center;
      background:linear-gradient(135deg,var(--primary),var(--primary-2));
      color:white;font-size:28px;box-shadow:var(--shadow)
    }
    h1{margin:0;font-size:clamp(20px,4vw,30px)}
    .sub{color:var(--muted);font-size:14px;margin-top:4px}

    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .grid{display:grid;gap:16px}

    .progress{
      background:#f2f4f7;border-radius:100px;height:12px;overflow:hidden
    }
    .bar{background:linear-gradient(90deg,var(--primary),var(--primary-2));height:100%;width:0%}

    .q-meta{display:flex;justify-content:space-between;align-items:center;gap:10px;color:var(--muted);font-size:14px}
    .q-title{font-size:clamp(18px,3.5vw,24px);margin:4px 0 10px}

    .choices{display:grid;gap:10px}
    .choice{
      border:2px solid #f0f0f0;border-radius:16px;padding:12px 14px;cursor:pointer;background:white;
      transition:transform .1s ease, border-color .15s ease, background .15s ease;
    }
    .choice:hover{transform:translateY(-2px);border-color:#ddd}
    .choice.selected{border-color:var(--primary-2);background:linear-gradient(0deg,#fff, #fff8fb)}
    .choice.correct{border-color:var(--success);background:linear-gradient(0deg,#fff, #f0fff4);color:var(--success)}
    .choice.wrong{border-color:var(--danger);background:linear-gradient(0deg,#fff, #fff1f2)}

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-top:8px}
    .btn{
      appearance:none;border:0;border-radius:14px;padding:12px 16px;cursor:pointer;font-weight:700
    }
    .primary{background:linear-gradient(135deg,var(--primary),var(--primary-2));color:white}
    .ghost{background:white;border:1.5px dashed #e5e7eb;color:var(--text)}
    .danger{background:var(--danger);color:white}
    .success{background:var(--success);color:white}

    .result h2{margin:6px 0 12px}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;background:#f8fafc;border:1px solid #eef2f7;color:#111827;font-weight:700}
    .badge .dot{width:10px;height:10px;border-radius:99px}

    .hidden{display:none}

    /* Ù„ÙˆØ­Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© */
    .cert-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);padding:16px}
    .cert{width:min(920px,94vw);background:white;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .cert-head{padding:18px 20px;background:linear-gradient(180deg,#fff7fb, #fff);border-bottom:1px solid #f1f5f9}
    .cert-body{padding:18px}
    .cert-grid{display:grid;gap:16px;grid-template-columns:1.2fr .8fr}
    .cert-preview{background:repeating-linear-gradient(45deg,#fafafa,#fafafa 10px,#f7f7f7 10px,#f7f7f7 20px);border-radius:16px;padding:10px}
    canvas{max-width:100%;height:auto;border-radius:12px;display:block;margin:auto}

    .foot{margin:26px 0 10px;color:var(--muted);font-size:13px;text-align:center}

    /* ÙƒÙˆÙ†ÙÙŠØªÙŠ */
    .confetti{position:fixed;top:-10px;width:10px;height:14px;opacity:.9;pointer-events:none;will-change:transform}
    @keyframes fall{to{transform:translateY(110vh) rotate(600deg)}}

    /* Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙÙ‚Ø· */
    @media print{ 
      body{background:white}
      #app, header, .foot{display:none !important}
      .cert-modal{position:static;display:block !important}
      .cert{box-shadow:none}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo" aria-hidden="true">â˜…</div>
      <div>
        <h1>ÙƒÙˆÙŠØ² Ø¹Ø§Ù… â€” Ù†Ø³Ø®Ø© Ù…ÙØ­Ø³Ù‘Ù†Ø©</h1>
        <div class="sub">Ø£Ø¬Ø¨ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¦Ù„Ø©ØŒ Ø«Ù… Ø§Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬ØªÙƒ. Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªÙÙØªØ­ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¥Ø°Ø§ Ø­Ù‚Ù‚Øª <b>80%</b> ÙØ£ÙƒØ«Ø±.</div>
      </div>
    </header>

    <main id="app" class="grid" aria-live="polite">
      <section id="quizCard" class="card">
        <div class="q-meta">
          <div id="qIndex">Ø§Ù„Ø³Ø¤Ø§Ù„ â€”</div>
          <div id="qTimer" class="badge"><span class="dot" style="background:#9ca3af"></span> Ù…Ø¤Ù‚Ù‘Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠ</div>
        </div>
        <div class="progress" aria-hidden="true"><div id="bar" class="bar"></div></div>
        <h2 id="qTitle" class="q-title">â€”</h2>
        <div id="choices" class="choices"></div>
        <div class="actions">
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="prevBtn" class="btn ghost" type="button">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
            <button id="nextBtn" class="btn primary" type="button">Ø§Ù„ØªØ§Ù„ÙŠ</button>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <button id="submitBtn" class="btn success" type="button">Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
            <button id="resetBtn" class="btn ghost" type="button">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
          </div>
        </div>
      </section>

      <section id="resultCard" class="card result hidden">
        <h2>Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h2>
        <p id="scoreLine" style="margin:6px 0 10px;font-weight:700"></p>
        <p id="adviceLine" style="margin:0 0 12px"></p>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="showCertBtn" class="btn primary hidden" type="button">ğŸ‰ Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
          <button id="retryBtn" class="btn ghost" type="button">ğŸ” Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        </div>
        <div class="sub" style="margin-top:12px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‚Ù„ÙŠÙ„Ù‹Ø§ (Ù…Ø«Ù„ 4)ØŒ ÙÙ‚Ø¯ ÙŠÙ„Ø²Ù…Ùƒ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¹Ù† Ø¬Ù…ÙŠØ¹Ù‡Ø§ Ù„Ø§Ø¬ØªÙŠØ§Ø² 80% (ÙŠÙÙ‚Ø±Ø¨ Ù„Ù„Ø£Ø¹Ù„Ù‰).</div>
      </section>
    </main>

    <div class="foot">ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: <b>Ø£/ ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ</b> â€” ÙŠØ¹Ù…Ù„ Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„. Â© 1447Ù‡Ù€</div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© -->
  <div id="certModal" class="cert-modal" role="dialog" aria-modal="true" aria-labelledby="certTitle">
    <div class="cert">
      <div class="cert-head">
        <h3 id="certTitle" style="margin:0">ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²</h3>
        <div class="sub">ØªØ¸Ù‡Ø± Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙÙ‚Ø· Ù„Ù…Ù† Ø§Ø¬ØªØ§Ø² Ù†Ø³Ø¨Ø© <b>80%</b> ÙØ£ÙƒØ«Ø±.</div>
      </div>
      <div class="cert-body">
        <div class="cert-grid">
          <div class="cert-preview">
            <canvas id="certCanvas" width="1200" height="800" aria-label="Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©"></canvas>
          </div>
          <div class="cert-form">
            <label for="studentName" style="font-weight:700;display:block;margin-bottom:6px">Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</label>
            <input id="studentName" type="text" placeholder="Ø§ÙƒØªÙØ¨/ÙŠ Ø§Ù„Ø§Ø³Ù… Ù‡Ù†Ø§" style="width:100%;padding:12px 14px;border:1.5px solid #e5e7eb;border-radius:12px" />

            <div style="display:grid;gap:10px;margin-top:14px">
              <button id="dlPngBtn" class="btn primary" type="button">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ÙƒØµÙˆØ±Ø© PNG</button>
              <button id="printBtn" class="btn ghost" type="button">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©</button>
              <button id="closeCertBtn" class="btn danger" type="button">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>

            <div class="sub" style="margin-top:12px">Ø³ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø§Ø³Ù… Ù…Ø­Ù„ÙŠÙ‹Ø§ Ù„Ø·Ø¨Ø§Ø¹ØªÙ‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ø³Ù‡ÙˆÙ„Ø©.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  // ===== 1) Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© + Ø³Ø¤Ø§Ù„ Ù…Ù† ØµÙØ­ØªÙƒ =====
  const questions = [
    {
      text: "ÙˆØ¬Ø¯ Ù¤ ØµÙÙˆÙØŒ ÙÙŠ ÙƒÙ„ ØµÙ Ù¢Ù¥ Ø·Ø§Ù„Ø¨Ø©. ÙƒÙ… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ØŸ",
      choices: ["Ù§Ù¥ Ø·Ø§Ù„Ø¨Ø©", "Ù¡Ù Ù  Ø·Ø§Ù„Ø¨Ø©", "Ù¡Ù¢Ù¥ Ø·Ø§Ù„Ø¨Ø©"],
      correctIndex: 1
    },
    {
      text: "Ù…Ø¹ Ø³Ø§Ø±Ø© Ù©Ù  Ø±ÙŠØ§Ù„Ù‹Ø§ØŒ Ø§Ø´ØªØ±Øª Ù„Ø¹Ø¨Ø© Ø¨Ù€Ù£Ù§ Ø±ÙŠØ§Ù„Ù‹Ø§. ÙƒÙ… ØªØ¨Ù‚Ù‘Ù‰ØŸ",
      choices: ["Ù¥Ù§ Ø±ÙŠØ§Ù„Ù‹Ø§", "Ù¥Ù£ Ø±ÙŠØ§Ù„Ù‹Ø§", "Ù¦Ù£ Ø±ÙŠØ§Ù„Ù‹Ø§"],
      correctIndex: 1
    },
    {
      text: "Ù£Ù¦ Ù‚Ù„Ù…Ù‹Ø§ ØªÙˆØ²Ù‘Ø¹ Ø¨Ø§Ù„ØªØ³Ø§ÙˆÙŠ Ø¹Ù„Ù‰ Ù¦ Ø·Ù„Ø§Ø¨. ÙƒÙ… Ù‚Ù„Ù…Ù‹Ø§ Ù„ÙƒÙ„ Ø·Ø§Ù„Ø¨ØŸ",
      choices: ["Ù¥ Ø£Ù‚Ù„Ø§Ù…", "Ù¦ Ø£Ù‚Ù„Ø§Ù…", "Ù§ Ø£Ù‚Ù„Ø§Ù…"],
      correctIndex: 1
    },
    {
      text: "ÙÙŠ Ù†Ø§Ø¯Ù Ø±ÙŠØ§Ø¶ÙŠØŒ Ø³Ø¬Ù„Øª Ø§Ù„Ø¨Ù†Ø§Øª Ù¤Ù¢ Ø­ØµØ© ÙˆØ§Ù„Ø£ÙˆÙ„Ø§Ø¯ Ù£Ù¥ Ø­ØµØ© Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹. Ø¨ÙƒÙ… ÙŠØ²ÙŠØ¯ Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ù†Ø§ØªØŸ",
      choices: ["Ù¥ Ø­ØµØµ", "Ù§ Ø­ØµØµ", "Ù© Ø­ØµØµ"],
      correctIndex: 1
    },
    {
      text: "ØµÙ†Ù‘ÙÙ Ø§Ù„Ø¹Ø¯Ø¯ Ù¡Ù :",
      choices: ["Ø£ÙˆÙ„ÙŠ", "ØºÙŠØ± Ø£ÙˆÙ„ÙŠ"],
      correctIndex: 1
    }
  ];

  // ===== 2) Ø§Ù„Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª =====
  const PASS_PCT = 80; // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø´Ù‡Ø§Ø¯Ø©
  let idx = 0;
  let answers = new Array(questions.length).fill(null); // index Ù„ÙƒÙ„ Ø§Ø®ØªÙŠØ§Ø±

  // ===== 3) Ø±Ø¨Ø· Ø§Ù„Ø¹Ù†Ø§ØµØ± =====
  const qIndex = document.getElementById('qIndex');
  const qTitle = document.getElementById('qTitle');
  const qTimer = document.getElementById('qTimer');
  const bar = document.getElementById('bar');
  const choicesEl = document.getElementById('choices');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  const resetBtn = document.getElementById('resetBtn');

  const resultCard = document.getElementById('resultCard');
  const scoreLine = document.getElementById('scoreLine');
  const adviceLine = document.getElementById('adviceLine');
  const showCertBtn = document.getElementById('showCertBtn');
  const retryBtn = document.getElementById('retryBtn');

  const certModal = document.getElementById('certModal');
  const certCanvas = document.getElementById('certCanvas');
  const ctx = certCanvas.getContext('2d');
  const studentNameInput = document.getElementById('studentName');
  const dlPngBtn = document.getElementById('dlPngBtn');
  const printBtn = document.getElementById('printBtn');
  const closeCertBtn = document.getElementById('closeCertBtn');

  // ===== 4) Ù…Ø¤Ù‚Ù‘Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) â€” Ø£Ù„ØºÙŠÙ†Ø§Ù‡ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ =====
  let timerOn = false; // Ø¥Ù† Ø±ØºØ¨ØªÙ Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø¤Ù‚ØªØŒ Ø§Ø¬Ø¹Ù„ÙŠÙ‡Ø§ true
  let timeLeft = 20;
  let timerId = null;

  function startTimer(){
    if(!timerOn) { qTimer.style.display='none'; return; }
    qTimer.style.display='inline-flex';
    updateTimerBadge();
    clearInterval(timerId);
    timerId = setInterval(()=>{
      timeLeft--; updateTimerBadge();
      if(timeLeft<=0){
        clearInterval(timerId);
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        next();
      }
    },1000);
  }
  function updateTimerBadge(){
    qTimer.innerHTML = `<span class="dot" style="background:${timeLeft<6?'#ef4444':'#9ca3af'}"></span> Ø§Ù„ÙˆÙ‚Øª: ${timeLeft} Ø«`;
  }

  // ===== 5) Ø±Ø³Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ =====
  function render(){
    const total = questions.length;
    qIndex.textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${idx+1} Ù…Ù† ${total}`;
    qTitle.textContent = questions[idx].text;

    // ØªÙ‚Ø¯Ù‘Ù…
    bar.style.width = `${((idx)/ (total-1)) * 100}%`;

    // Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
    choicesEl.innerHTML = '';
    questions[idx].choices.forEach((choice, i)=>{
      const btn = document.createElement('button');
      btn.type='button';
      btn.className = 'choice';
      btn.textContent = choice;
      if(answers[idx] === i) btn.classList.add('selected');
      btn.addEventListener('click', ()=>{
        answers[idx] = i;
        // ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© ÙÙˆØ±ÙŠØ©: Ø§Ù„Ø£Ø®Ø¶Ø± Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
        document.querySelectorAll('.choice').forEach((c,j)=>{
          c.classList.remove('selected','correct','wrong');
          if(j === i){
            if(i === questions[idx].correctIndex) c.classList.add('correct');
            else c.classList.add('wrong');
          }
          if(j === questions[idx].correctIndex) c.classList.add('correct');
        });
      });
      choicesEl.appendChild(btn);
    });

    // Ø¥Ø°Ø§ ØªÙ…Øª Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø³Ø§Ø¨Ù‚Ù‹Ø§ØŒ Ø£Ø¸Ù‡Ø± Ø§Ù„ØªØµØ­ÙŠØ­ ÙÙˆØ±Ù‹Ø§ (Ø§Ù„Ø£Ø®Ø¶Ø± Ù„Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©)
    if(answers[idx] !== null){
      const correctIdx = questions[idx].correctIndex;
      const selectedIdx = answers[idx];
      document.querySelectorAll('.choice').forEach((c,j)=>{
        c.classList.remove('selected','correct','wrong');
        if(j === selectedIdx){
          if(selectedIdx === correctIdx) c.classList.add('correct');
          else c.classList.add('wrong');
        }
        if(j === correctIdx) c.classList.add('correct');
      });
    }

    prevBtn.disabled = idx===0;
    nextBtn.disabled = idx===total-1;

    // Ù…Ø¤Ù‚Øª Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ (Ø¥Ù† ÙƒØ§Ù† Ù…ÙØ¹Ù„Ø§Ù‹)
    timeLeft = 20; // Ø«ÙˆØ§Ù†ÙŠ Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„
    startTimer();
  }

  function next(){
    const last = questions.length-1;
    if(idx < last){ idx++; render(); }
  }
  function prev(){
    if(idx>0){ idx--; render(); }
  }

  function calcScore(){
    let correct = 0;
    answers.forEach((ans, i)=>{ if(ans === questions[i].correctIndex) correct++; });
    const total = questions.length;
    const pct = Math.round((correct/total)*100);
    // Ø£Ù‚Ù„ Ø¹Ø¯Ø¯ ØµØ­ÙŠØ­ Ù„Ù„Ø§Ø¬ØªÙŠØ§Ø² (ØªÙ‚Ø±ÙŠØ¨ Ù„Ù„Ø£Ø¹Ù„Ù‰)
    const needed = Math.ceil((PASS_PCT/100)*total);
    return {correct,total,pct,needed};
  }

  function showResult(){
    const {correct,total,pct,needed} = calcScore();

    // ØªÙ…ÙŠÙŠØ² Ø§Ù„ØµØ­ÙŠØ­ Ø¨Ø§Ù„Ø£Ø®Ø¶Ø± ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    choicesEl.querySelectorAll('.choice').forEach((el,i)=>{
      el.classList.remove('selected');
      const isCorrect = i === questions[idx].correctIndex;
      if(isCorrect) el.classList.add('correct');
    });

    document.getElementById('quizCard').classList.add('hidden');
    resultCard.classList.remove('hidden');

    scoreLine.textContent = `Ø­ØµÙ„ØªÙ/ØªÙ Ø¹Ù„Ù‰ ${correct} Ù…Ù† ${total} â€” Ù†Ø³Ø¨Ø© ${pct}% (Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„Ø§Ø¬ØªÙŠØ§Ø²: ${needed}/${total})`;

    const passed = correct >= needed;
    if(passed){
      adviceLine.innerHTML = `Ø£Ø­Ø³Ù†Øª! Ø§Ø¬ØªØ²ØªÙ/ØªÙ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±. Ø§Ø¶ØºØ·/ÙŠ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©.`;
      showCertBtn.classList.remove('hidden');
      fireConfetti();
      // Ø­ÙØ¸ Ø¢Ø®Ø± Ù†ØªÙŠØ¬Ø©
      localStorage.setItem('lastScore', JSON.stringify({correct,total,pct,date: new Date().toISOString()}));
    } else {
      adviceLine.innerHTML = `Ù„Ù… ØªØµÙ„/ÙŠ Ø¥Ù„Ù‰ Ù†Ø³Ø¨Ø© <b>${PASS_PCT}%</b> Ø¨Ø¹Ø¯. Ø±Ø§Ø¬Ø¹/ÙŠ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© ÙˆØ¬Ø±Ù‘Ø¨/ÙŠ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ â€” Ø£Ù†Øª ØªØ³ØªØ·ÙŠØ¹/ÙŠÙ†!`;
      showCertBtn.classList.add('hidden');
    }
  }

  function resetAll(){
    idx = 0; answers = new Array(questions.length).fill(null);
    document.getElementById('quizCard').classList.remove('hidden');
    resultCard.classList.add('hidden');
    render();
  }

  // ===== 6) Ø§Ù„Ø´Ù‡Ø§Ø¯Ø©: Ø±Ø³Ù… Ø¹Ù„Ù‰ Canvas (Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©) =====
  function drawCertificate(){
    const name = (studentNameInput.value || 'Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø©').trim();
    localStorage.setItem('studentName', name);

    const {correct,total,pct} = calcScore();

    // Ø®Ù„ÙÙŠØ© Ù…ØªØ¯Ø±Ø¬Ø©
    const g = ctx.createLinearGradient(0,0,0,800);
    g.addColorStop(0,'#fff7fb');
    g.addColorStop(.6,'#fff');
    g.addColorStop(1,'#f7fbff');
    ctx.fillStyle = g; ctx.fillRect(0,0,1200,800);

    // Ø¥Ø·Ø§Ø± Ø°Ù‡Ø¨ÙŠ
    ctx.strokeStyle = '#fbbf24';
    ctx.lineWidth = 10; ctx.strokeRect(40,40,1120,720);

    // Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ
    const g2 = ctx.createLinearGradient(0,0,1200,0);
    g2.addColorStop(0,'#ff3d71'); g2.addColorStop(1,'#ff6ea2');
    ctx.fillStyle = g2; ctx.fillRect(40,40,1120,90);

    // Ø¹Ù†ÙˆØ§Ù†
    ctx.fillStyle = '#ffffff';
    ctx.font = 'bold 44px "Noto Sans Arabic", Tahoma, Arial';
    ctx.textAlign = 'center';
    ctx.fillText('ğŸ† Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù†Ø¬Ø§Ø²', 600, 100);

    // Ù†Øµ Ø±Ø¦ÙŠØ³ÙŠ
    ctx.fillStyle = '#111827';
    ctx.font = '700 40px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillText('ØªÙÙ…Ù†ÙØ­ Ù‡Ø°Ù‡ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø¥Ù„Ù‰', 600, 220);

    // Ø§Ù„Ø§Ø³Ù…
    ctx.font = '800 56px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillStyle = '#1f2937';
    ctx.fillText(name, 600, 290);

    // Ù†Ø³Ø¨Ø© ÙˆÙ†ØªÙŠØ¬Ø©
    ctx.font = '600 28px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillStyle = '#374151';
    const pctText = `Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${correct}/${total} â€” ${pct}%`;
    ctx.fillText(pctText, 600, 340);

    // Ø³Ø·Ø± Ø«Ø§Ù†Ù
    ctx.font = '400 26px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillStyle = '#4b5563';
    ctx.fillText('Ù„Ø§Ø³ØªÙƒÙ…Ø§Ù„Ù‡/Ù‡Ø§ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ ÙˆØªØ­Ù‚ÙŠÙ‚ Ù†Ø³Ø¨Ø© 80% ÙØ£ÙƒØ«Ø±.', 600, 380);

    // Ù†Ø¬ÙˆÙ… Ø²Ø®Ø±ÙÙŠØ©
    ctx.font = 'bold 60px Arial';
    const stars = ['â­','â­','â­','â­','â­'];
    ctx.fillText(stars.join(' '), 600, 460);

    // Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ØªÙˆÙ‚ÙŠØ¹
    const dateStr = new Date().toLocaleDateString('ar-SA', { year:'numeric', month:'long', day:'numeric' });
    ctx.font = '600 24px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillStyle = '#111827';
    ctx.textAlign = 'left';
    ctx.fillText(`Ø§Ù„ØªØ§Ø±ÙŠØ®: ${dateStr}`, 80, 540);
    ctx.textAlign = 'right';
    ctx.fillText('ØªØµÙ…ÙŠÙ… ÙˆØ¨Ø±Ù…Ø¬Ø©: Ø£/ ÙØ§Ø·Ù…Ø© Ù‡Ø²Ø§Ø²ÙŠ', 1120, 540);

    // Ø®ØªÙ… Ø¯Ø§Ø¦Ø±ÙŠ Ø¨Ø³ÙŠØ·
    ctx.save();
    ctx.translate(980, 620);
    ctx.rotate(-0.15);
    ctx.strokeStyle = '#f59e0b';
    ctx.lineWidth = 6;
    ctx.beginPath(); ctx.arc(0,0,70,0,Math.PI*2); ctx.stroke();
    ctx.font = 'bold 18px "Noto Sans Arabic", Tahoma, Arial';
    ctx.fillStyle = '#f59e0b';
    ctx.textAlign = 'center';
    ctx.fillText('Najm â­ Math', 0, -8);
    ctx.fillText('CERTIFIED', 0, 18);
    ctx.restore();
  }

  function openCert(){
    drawCertificate();
    certModal.style.display='flex';
  }
  function closeCert(){
    certModal.style.display='none';
  }

  dlPngBtn?.addEventListener('click', ()=>{
    drawCertificate();
    const url = certCanvas.toDataURL('image/png');
    const a = document.createElement('a');
    a.href = url; a.download = `Ø´Ù‡Ø§Ø¯Ø©-Ø¥Ù†Ø¬Ø§Ø².png`;
    a.click();
  });
  printBtn?.addEventListener('click', ()=>{
    drawCertificate();
    window.print();
  });
  closeCertBtn?.addEventListener('click', closeCert);
  studentNameInput?.addEventListener('input', drawCertificate);

  // Ø­ÙØ¸/ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…
  const savedName = localStorage.getItem('studentName');
  if(savedName) studentNameInput.value = savedName;

  // ===== 7) ÙƒÙˆÙ†ÙÙŠØªÙŠ Ø¨Ø³ÙŠØ· â€” Ø¨Ø¯ÙˆÙ† Ù…ÙƒØªØ¨Ø§Øª =====
  function fireConfetti(){
    const n = 140;
    for(let i=0;i<n;i++){
      const d = document.createElement('div');
      d.className='confetti';
      const size = 8 + Math.random()*8;
      d.style.width = size+'px';
      d.style.height = (size*1.3)+'px';
      d.style.left = (Math.random()*100)+'vw';
      d.style.background = `hsl(${Math.random()*360}, 90%, 60%)`;
      d.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
      d.style.animation = `fall ${4+Math.random()*3}s linear forwards`;
      d.style.borderRadius = '3px';
      document.body.appendChild(d);
      setTimeout(()=> d.remove(), 8000);
    }
  }

  // ===== 8) Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø± =====
  prevBtn.addEventListener('click', prev);
  nextBtn.addEventListener('click', next);
  submitBtn.addEventListener('click', showResult);
  resetBtn.addEventListener('click', resetAll);
  retryBtn.addEventListener('click', resetAll);
  showCertBtn.addEventListener('click', openCert);

  // Ø¨Ø¯Ø§ÙŠØ©
  render();
})();
</script>
</body>
</html>
